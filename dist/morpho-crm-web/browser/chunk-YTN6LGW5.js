import{a as A,b as _}from"./chunk-3KBNJFMX.js";import"./chunk-OVD5OBXF.js";import"./chunk-SAIHPVLC.js";import"./chunk-ICXQ7NUM.js";import{a as b}from"./chunk-E3JTDT4M.js";import"./chunk-BYXBJQAS.js";import"./chunk-T4HB4AXC.js";import{S as x,q as S,w as E}from"./chunk-XICAGMBR.js";import{Db as u,Pa as L,V as l,c,gb as f,hb as r,ia as o,ib as i,tb as h,za as p}from"./chunk-MI4VSIZJ.js";var w=class v{leadService=l(b);router=l(S);toastService=l(E);fb=l(x);leadId=o(null);isEditMode=o(!1);formTitle=o("Create Lead");showAddressForm=o(!1);leadSources=[];leadStatuses=[];isLoading=o(!1);get saveButtonText(){return this.isEditMode()?"Update and Continue":"Save and Continue"}get saveAndExitButtonText(){return this.isEditMode()?"Update and Exit":"Save and Exit"}ngOnInit(){let t=new URLSearchParams(window.location.search);this.leadId.set(t.get("leadId")),console.log("Lead ID from query params:",this.leadId()),this.isEditMode.set(this.leadId()!==null),this.isEditMode()&&(this.formTitle.set("Edit Lead"),this.showAddressForm.set(!0)),this.setLeadsLookupData()}setLeadsLookupData(){this.getLeadSources(),this.getLeadStatuses()}getLeadSources(){this.leadService.getLeadSources().subscribe({next:t=>{this.leadSources=t},error:t=>{console.error("Error fetching lead sources:",t)}})}getLeadStatuses(){this.leadService.getLeadsLookupData().subscribe({next:t=>{this.leadStatuses=t.leadStatuses.map(a=>({label:a.label,value:a.value}))},error:t=>{console.error("Error fetching lead statuses:",t)}})}onFormSubmit(t){let{data:a,action:e}=t;this.isLoading()||(this.isLoading.set(!0),a.leadId?this.updateLead(a,e):this.createLead(a,e))}onFormCancel(){this.router.navigate(["/leads"])}createLead(t,a){let n=t,{leadId:e}=n,d=c(n,["leadId"]),s={leadOwnerId:d.leadOwnerId,leadOwnerName:d.leadOwnerName,leadSourceId:d.leadSourceId||null,leadStatus:d.leadStatus||"New",leadTopic:d.leadTopic||null,leadConversionDate:d.leadConversionDate,firstName:d.firstName||"",lastName:d.lastName||null,phone:d.phoneNumber||null,email:d.email||null,companyName:d.companyName||null};this.leadService.createLead(s).subscribe({next:m=>{this.isLoading.set(!1),m&&(this.leadId.set(m.leadId),this.isEditMode.set(!0),this.formTitle.set("Edit Lead"),this.toastService.success("Lead saved successfully"),a==="next"?(this.showAddressForm.set(!0),setTimeout(()=>{let g=document.getElementById("lead-address-form");g&&g.scrollIntoView({behavior:"smooth"})},1500)):a==="saveAndExit"&&this.router.navigate(["/leads"]))},error:m=>{this.isLoading.set(!1),console.error("Error creating lead:",m)}})}updateLead(t,a){let e=c(t,[]),d={leadId:e.leadId,leadOwnerId:e.leadOwnerId||void 0,leadOwnerName:e.leadOwnerName||void 0,leadSourceId:e.leadSourceId||void 0,leadStatus:e.leadStatus||void 0,leadTopic:e.leadTopic||void 0,leadConversionDate:e.leadConversionDate||void 0,firstName:e.firstName||void 0,lastName:e.lastName||void 0,phone:e.phoneNumber||void 0,email:e.email||void 0,companyName:e.companyName||void 0};this.leadService.updateLead(d).subscribe({next:s=>{this.isLoading.set(!1),s&&(this.toastService.success("Lead updated successfully"),a==="next"?(this.showAddressForm.set(!0),setTimeout(()=>{let n=document.getElementById("lead-address-form");n&&n.scrollIntoView({behavior:"smooth"})},500)):a==="saveAndExit"&&this.router.navigate(["/leads"]))},error:s=>{this.isLoading.set(!1),console.error("Error updating lead:",s)}})}onAddressFormSubmit(t,a="save"){t.isPrimary=!0,this.leadService.createLeadAddress(this.leadId(),t).subscribe({next:e=>{e.addressId&&(this.toastService.success("Lead address saved successfully"),a==="saveAndExit"&&this.router.navigate(["/leads"]))},error:e=>{console.error("Error creating lead address:",e)}})}onAddressFormCancel(){this.router.navigate(["/leads"])}static \u0275fac=function(a){return new(a||v)};static \u0275cmp=L({type:v,selectors:[["app-leads-create-or-update"]],decls:17,vars:17,consts:[[1,"divide-y","divide-gray-900/10","dark:divide-white/10"],[1,"grid","grid-cols-1","gap-x-8","gap-y-8","py-10","md:grid-cols-3"],[1,"px-4","sm:px-0"],[1,"text-base/7","font-semibold","text-gray-900","dark:text-white"],[1,"mt-1","text-sm/6","text-gray-600","dark:text-gray-400"],[1,"md:col-span-2","bg-white","shadow-xs","outline","outline-gray-900/5","sm:rounded-xl","dark:bg-gray-800/50","dark:shadow-none","dark:-outline-offset-1","dark:outline-white/10"],[3,"formSubmit","formCancel","addressFormSubmit","leadStatusOptions","leadSourceOptions","isEditMode","formTitle","leadId","isLoading","saveButtonText","saveAndExitButtonText","showNextButton","showSaveAndExitButton"],["id","lead-address-form",1,"grid","grid-cols-1","gap-x-8","gap-y-8","py-10","md:grid-cols-3"],[1,"md:col-span-2","px-4","sm:px-0","bg-white","shadow-xs","outline","outline-gray-900/5","sm:rounded-xl","dark:bg-gray-800/50","dark:shadow-none","dark:-outline-offset-1","dark:outline-white/10"],[3,"submitAddress","cancelAddress","setLeadId","isEditMode","isLoading","saveButtonText","saveAndExitButtonText","showNextButton","showSaveAndExitButton"]],template:function(a,e){a&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),u(4,"Lead Information"),i(),r(5,"p",4),u(6,"This information will be used as part of the lead profile."),i()(),r(7,"div",5)(8,"app-lead-form",6),h("formSubmit",function(s){return e.onFormSubmit(s)})("formCancel",function(){return e.onFormCancel()})("addressFormSubmit",function(s){return e.onAddressFormSubmit(s.data,s.action)}),i()()()(),r(9,"div",7)(10,"div",2)(11,"h2",3),u(12,"Lead Address Information"),i(),r(13,"p",4),u(14,"A primary address of your Lead."),i()(),r(15,"div",8)(16,"app-lead-address-form",9),h("submitAddress",function(s){return e.onAddressFormSubmit(s.data,s.action)})("cancelAddress",function(){return e.onFormCancel()}),i()()()),a&2&&(p(8),f("leadStatusOptions",e.leadStatuses)("leadSourceOptions",e.leadSources)("isEditMode",e.isEditMode())("formTitle",e.formTitle())("leadId",e.leadId())("isLoading",e.isLoading())("saveButtonText",e.saveButtonText)("saveAndExitButtonText",e.saveAndExitButtonText)("showNextButton",!0)("showSaveAndExitButton",!0),p(8),f("setLeadId",e.leadId())("isEditMode",e.isEditMode())("isLoading",e.isLoading())("saveButtonText",e.saveButtonText)("saveAndExitButtonText",e.saveAndExitButtonText)("showNextButton",!0)("showSaveAndExitButton",!0))},dependencies:[_,A],encapsulation:2})};export{w as LeadsCreateOrUpdate};
